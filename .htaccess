<IfModule mod_negotiation.c>
    Options -MultiViews
</IfModule>

<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
</IfModule>

RewriteEngine On

# Handle team abbreviation URLs (3 uppercase letters)
RewriteRule ^([A-Z]{3})/?$ index.php?team_abbr=$1 [QSA,L]

# Allow direct access to actual files
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Handle PHP files with clean URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f 
RewriteRule ^([^/]+)/?$ $1.php [L]

# Special handling for pages directory files when accessed directly
RewriteRule ^pages/last-season-overview/?$ pages/last-season-overview.php [L]

# Handle clean URLs for pages directory files
RewriteRule ^last-season-overview/?$ pages/last-season-overview.php [L]

# Explicitly handle ajax requests to avoid 403 errors
RewriteCond %{HTTP:X-Requested-With} =XMLHttpRequest
RewriteCond %{REQUEST_URI} ^/nhl/ajax/(.*)$ [OR]
RewriteCond %{REQUEST_URI} ^/ajax/(.*)$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ - [L]

# Redirect non-AJAX requests from /ajax/ prefix to clean URLs
RewriteCond %{HTTP:X-Requested-With} !=XMLHttpRequest
RewriteRule ^ajax/([^/]+)$ $1 [R=301,L]

# If not found as a file or directory, try in ajax directory
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/]+)/?$ ajax/$1.php [L]

# If still not found, try in pages directory
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/]+)/?$ pages/$1.php [L]